{% extends "base.html" %}
{% block title %}{{ video.title }}{% endblock %}

{% block content %}
<div class="watch-page">
  <div class="watch-player-wrap glass">
    {% if can_watch %}
    <div class="watch-player-shell">
      <video
        class="watch-player"
        id="watch-video"
        preload="metadata"
        oncontextmenu="return false"
        {% if video.thumbnail %}poster="{{ url_for('thumb', rank=video.rank, filename=video.thumbnail) }}"{% endif %}
        src="{{ url_for('stream_video', rank=video.rank, filename=video.filename) }}"
      >
        Your browser does not support the video tag.
      </video>
      <div class="player-overlay loading active" id="player-loading">
        <div class="player-spinner"></div>
      </div>
      <div class="tap-zones">
        <div class="tap-zone left" id="tap-left">
          <span class="tap-label">-10s</span>
        </div>
        <div class="tap-zone right" id="tap-right">
          <span class="tap-label">+10s</span>
        </div>
      </div>
      <div class="player-controls" id="player-controls">
        <button type="button" class="player-btn" id="player-play">‚ñ∂</button>
        <button type="button" class="player-btn" id="player-back">-10s</button>
        <div class="player-progress-wrap">
          <span class="player-time" id="player-current">0:00</span>
          <div class="player-progress-inner">
            <input type="range" id="player-progress" min="0" max="100" value="0" step="0.1">
            <div class="player-hover-time" id="player-hover-time">0:00</div>
          </div>
          <span class="player-time" id="player-duration">0:00</span>
        </div>
        <button type="button" class="player-btn" id="player-forward">+10s</button>
      </div>
    </div>
    {% else %}
    <div class="rank-not-eligible">
      <div class="rank-not-eligible-icon">üîí</div>
      <h2>Rank not eligible</h2>
      <p>This video is for <strong>{{ video.rank }}</strong> tier. Your current rank does not have access. Upgrade your rank to watch.</p>
      <a href="{{ url_for('home') }}" class="btn btn-primary">‚Üê Back to videos</a>
    </div>
    {% endif %}
  </div>
  <div class="watch-info">
    <span class="watch-rank rank-{{ video.rank }}">{{ video.rank }}</span>
    <h1 class="watch-title">{{ video.title }}</h1>
    {% if video.description %}
    <div class="watch-description">{{ video.description }}</div>
    {% endif %}
  </div>
  <a href="{{ url_for('home') }}" class="btn btn-secondary back-link">‚Üê Back to videos</a>
</div>
{% endblock %}
